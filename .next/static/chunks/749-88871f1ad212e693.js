"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[749],{3749:(e,t,r)=>{r.d(t,{A:()=>x});var n=r(5155),s=r(2115),o=r(5606),a=r(8768),i=r(3937),l=r(1336),c=r(3569),d=r(8125),u=r(1915),g=r(2187),m=r(8003);let h=null;function w(e){return new Promise((t,r)=>{let n=document.querySelector('script[src="'.concat(e,'"]'));if(n)return"true"===n.getAttribute("data-loaded")?t():(n.addEventListener("load",()=>t()),void n.addEventListener("error",()=>r(Error("Failed to load ".concat(e)))));let s=document.createElement("script");s.src=e,s.async=!0,s.defer=!0,s.addEventListener("load",()=>{s.setAttribute("data-loaded","true"),t()}),s.addEventListener("error",()=>r(Error("Failed to load ".concat(e)))),document.head.appendChild(s)})}async function b(){if(h)return h;try{let e="3.8.10",t="https://source.zoom.us/".concat(e,"/lib/vendor/react.min.js"),r="https://source.zoom.us/".concat(e,"/lib/vendor/react-dom.min.js"),n="https://source.zoom.us/".concat(e,"/zoom-meeting-embedded-").concat(e,".min.js");if(await w(t),await w(r),await w(n),!window.ZoomMtgEmbedded)throw Error("Zoom UMD not available on window");return h=window.ZoomMtgEmbedded}catch(e){throw console.error("Failed to load Zoom SDK:",e),Error("Unable to load Zoom webinar player. Please check your internet connection and try again.")}}function x(e){let{webinarId:t,webinarTitle:r,userName:h,userEmail:w,onClose:x,onError:f}=e,[p,y]=(0,s.useState)({isConnecting:!0,isConnected:!1,isFullscreen:!1,audioMuted:!0,videoMuted:!0,participantCount:0,connectionQuality:"unknown",hasError:!1,errorMessage:""}),E=(0,s.useRef)(null),j=(0,s.useRef)(null),v=(0,s.useRef)(null),N=(0,s.useRef)(!1),C=(0,s.useCallback)(e=>{if(console.log("[DEBUG] Parsing webinar ID:",e),/^\d+$/.test(e))return console.log("[DEBUG] Direct meeting number detected:",e),{meetingNumber:e,password:""};try{let t=new URL(e);console.log("[DEBUG] Parsing URL:",t.href);let r=t.pathname.split("/").filter(Boolean);console.log("[DEBUG] URL path parts:",r);let n="",s=r.findIndex(e=>"w"===e||"j"===e);if(-1!==s&&r[s+1]&&(n=r[s+1].replace(/\D/g,"")),!n){let e=r[r.length-1];e&&(n=e.replace(/\D/g,""))}if(!n){let t=e.match(/\d+/g);t&&t.length>0&&(n=t.reduce((e,t)=>e.length>t.length?e:t))}let o=t.searchParams.get("pwd")||t.searchParams.get("password")||"";if(o)try{let e=decodeURIComponent(o);console.log("[DEBUG] Password decoding:",{original:o,decoded:e,needsDecoding:o!==e}),o=e}catch(e){console.log("[DEBUG] Password decode failed, using original:",o)}return console.log("[DEBUG] Extracted meeting number:",n,"password:",o?"[REDACTED]":"none"),{meetingNumber:n||e,password:o}}catch(t){return console.log("[DEBUG] URL parsing failed, treating as direct meeting number:",e),{meetingNumber:e,password:""}}},[]),D=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{console.log("[DEBUG] Fetching signature for meeting:",e,"with role:",t);let r=await fetch("/api/zoom/webinar-signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({meetingNumber:e,role:t})});if(console.log("[DEBUG] Signature fetch response status:",r.status),!r.ok){let e=await r.text();throw console.error("[DEBUG] Signature fetch failed. Body:",e),Error("Authentication failed: ".concat(r.status))}let n=await r.json();if(console.log("[DEBUG] Signature response JSON:",n),!n.signature||!n.sdkKey)throw Error("Invalid authentication response");return n}catch(e){throw console.error("Signature generation failed:",e),Error("Unable to authenticate for webinar access. Please try again.")}},[]),U=(0,s.useCallback)(async()=>{if(!N.current){N.current=!0;try{y(e=>({...e,isConnecting:!0,hasError:!1}));let{meetingNumber:e,password:r}=C(t);if(console.log("Joining webinar:",{meetingNumber:e,password:r?"[REDACTED]":"none"}),!e)throw Error("Meeting number is required to join the webinar");if(!w)throw Error("Email address is required to join webinars");if(!h)throw Error("User name is required to join the webinar");console.log("[DEBUG] Loading Zoom Embedded SDK...");let n=await b();console.log("[DEBUG] Zoom Embedded loaded:",!!n);let s=await D(e);console.log("[DEBUG] Creating Zoom client...");let o=n.createClient();E.current=o,console.log("[DEBUG] Zoom client created"),console.log("[DEBUG] Initializing Zoom client...");let a=j.current;if(!a)throw Error("Zoom container not ready");console.log("[DEBUG] Zoom container ready:",a),await o.init({language:"en-US",zoomAppRoot:a,patchJsMedia:!0,customize:{video:{isResizable:!0,popper:{disableDraggable:!1}},meetingInfo:["topic","host","mn","participant","dc","enctype"],toolbar:{buttons:[]}}}),console.log("[DEBUG] Zoom client initialized");try{o.on("connection-change",e=>{console.log("Connection status:",e),e&&e.state&&("Connected"===e.state?y(e=>({...e,connectionQuality:"excellent",isConnected:!0,isConnecting:!1,hasError:!1})):"Fail"===e.state&&e.reason&&!e.reason.includes("Meeting Passcode wrong")&&y(e=>({...e,connectionQuality:"poor"})))}),console.log("[DEBUG] Event listeners set up")}catch(e){console.warn("Could not set up event listeners:",e)}console.log("[DEBUG] Attempting to join meeting:",e);let i={signature:s.signature,sdkKey:s.sdkKey,meetingNumber:e,userName:h,userEmail:w,password:r};console.log("[DEBUG] Join parameters:",{...i,signature:"[REDACTED]",password:r?"[REDACTED]":"none",passwordLength:r?r.length:0,passwordPreview:r?r.substring(0,3)+"...":"none"});try{await o.join(i)}catch(t){if(console.log("[DEBUG] Initial join failed:",t),3004===t.errorCode&&r){console.log("[DEBUG] Password error, trying with passWord parameter...");let t={...i,passWord:r};delete t.password;try{await o.join(t)}catch(t){if(3004===t.errorCode){console.log("[DEBUG] Both password formats failed, trying without password...");let t={signature:s.signature,sdkKey:s.sdkKey,meetingNumber:e,userName:h,userEmail:w};await o.join(t)}else throw t}}else if(3008===t.errorCode){console.log("[DEBUG] Meeting not started error. Trying with webinar-specific parameters...");let t=await D(e,1),n={signature:t.signature,sdkKey:t.sdkKey,meetingNumber:e,userName:h,userEmail:w,password:r,role:1};console.log("[DEBUG] Trying webinar join as panelist with role 1 signature..."),await o.join(n)}else throw t}console.log("[DEBUG] Successfully joined webinar"),y(e=>({...e,isConnecting:!1,isConnected:!0}))}catch(t){console.error("Webinar initialization failed:",t);let e="Failed to join webinar. Please try again.";if(t.errorCode)switch(t.errorCode){case 3706:e="The webinar meeting number is invalid or the webinar is not currently active. Please check the meeting number and try again.";break;case 3707:e="The webinar password is incorrect. Please check the password and try again.";break;case 3708:e="The webinar has not started yet or has already ended.";break;case 3709:e="You are not authorized to join this webinar.";break;default:e="Webinar join failed: ".concat(t.reason||t.message||"Unknown error")}else t.reason?e="Connection failed: ".concat(t.reason):t.message&&(e=t.message);y(t=>({...t,isConnecting:!1,hasError:!0,errorMessage:e})),f(e)}}},[t,h,w,C,D,f]),k=(0,s.useCallback)(async()=>{try{E.current&&("function"==typeof E.current.leave&&await E.current.leave(),"function"==typeof E.current.destroy&&await E.current.destroy())}catch(e){console.warn("Error leaving webinar:",e)}finally{E.current=null,N.current=!1,x()}},[x]),B=(0,s.useCallback)(()=>{v.current&&(document.fullscreenElement?document.exitFullscreen().then(()=>{y(e=>({...e,isFullscreen:!1}))}).catch(console.error):v.current.requestFullscreen().then(()=>{y(e=>({...e,isFullscreen:!0}))}).catch(console.error))},[]);return(0,s.useEffect)(()=>{let e=()=>{y(e=>({...e,isFullscreen:!!document.fullscreenElement}))};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),(0,s.useEffect)(()=>(U(),()=>{if(E.current)try{"function"==typeof E.current.leave&&E.current.leave().catch(console.error),"function"==typeof E.current.destroy&&E.current.destroy().catch(console.error)}catch(e){console.warn("Error in cleanup:",e)}}),[U]),(0,n.jsxs)("div",{ref:v,className:"fixed inset-0 bg-black z-50 flex flex-col ".concat(p.isFullscreen?"p-0":"p-1 sm:p-2"),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between bg-gray-900/90 text-white p-3 rounded-t-lg ".concat(p.isFullscreen?"absolute top-0 left-0 right-0 z-10":""),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("h3",{className:"font-semibold text-sm sm:text-base truncate max-w-xs sm:max-w-md",children:r}),(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-xs sm:text-sm text-gray-300",children:[(()=>{switch(p.connectionQuality){case"excellent":return(0,n.jsx)(o.A,{className:"h-4 w-4 text-green-500"});case"good":return(0,n.jsx)(o.A,{className:"h-4 w-4 text-yellow-500"});case"poor":return(0,n.jsx)(o.A,{className:"h-4 w-4 text-red-500"});default:return(0,n.jsx)(o.A,{className:"h-4 w-4 text-gray-400"})}})(),(0,n.jsx)("span",{className:"hidden sm:inline",children:"unknown"===p.connectionQuality?"Connecting...":p.connectionQuality})]}),p.participantCount>0&&(0,n.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-300",children:[(0,n.jsx)(a.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:p.participantCount})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{onClick:B,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:p.isFullscreen?"Exit fullscreen":"Enter fullscreen",children:p.isFullscreen?(0,n.jsx)(i.A,{className:"h-5 w-5"}):(0,n.jsx)(l.A,{className:"h-5 w-5"})}),(0,n.jsx)("button",{onClick:k,className:"p-2 hover:bg-red-600 rounded-lg transition-colors",title:"Leave webinar",children:(0,n.jsx)(c.A,{className:"h-5 w-5"})})]})]}),(0,n.jsxs)("div",{className:"flex-1 bg-gray-100 relative ".concat(p.isFullscreen?"mt-16":"rounded-lg mt-2"," overflow-hidden"),children:[p.isConnecting&&(0,n.jsx)("div",{className:"absolute inset-0 bg-gray-900/95 flex items-center justify-center z-20",children:(0,n.jsxs)("div",{className:"text-center text-white",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-6"}),(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Connecting to webinar..."}),(0,n.jsx)("p",{className:"text-gray-300",children:"Please wait while we set up your session"})]})}),p.hasError&&(0,n.jsx)("div",{className:"absolute inset-0 bg-gray-900/95 flex items-center justify-center z-20",children:(0,n.jsxs)("div",{className:"text-center text-white max-w-md mx-auto p-6",children:[(0,n.jsx)(d.A,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Connection Failed"}),(0,n.jsx)("p",{className:"text-gray-300 mb-6",children:p.errorMessage}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,n.jsx)("button",{onClick:()=>{y(e=>({...e,hasError:!1})),N.current=!1,U()},className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors",children:"Try Again"}),(0,n.jsx)("button",{onClick:k,className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold transition-colors",children:"Close"})]})]})}),(0,n.jsx)("div",{ref:j,className:"w-full h-full",style:{minHeight:p.isFullscreen?"100vh":"70vh",height:p.isFullscreen?"100vh":"70vh"}})]}),!p.isFullscreen&&p.isConnected&&(0,n.jsxs)("div",{className:"bg-gray-900/90 text-white p-3 rounded-b-lg flex items-center justify-between",children:[(0,n.jsx)("div",{className:"flex items-center space-x-4",children:(0,n.jsx)("span",{className:"text-sm text-gray-300",children:"Webinar Controls"})}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Settings",children:(0,n.jsx)(u.A,{className:"h-5 w-5"})}),(0,n.jsx)("button",{className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Chat",children:(0,n.jsx)(g.A,{className:"h-5 w-5"})}),(0,n.jsx)("button",{className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Raise hand",children:(0,n.jsx)(m.A,{className:"h-5 w-5"})})]})]})]})}}}]);